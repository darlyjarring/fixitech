<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Fixitech Designer Ultra</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --primary: #00d4ff; --panel: #252526; }
        body { margin: 0; font-family: 'Segoe UI', sans-serif; display: flex; height: 100vh; background: #121212; color: white; overflow: hidden; }

        /* PANEL IZQUIERDO */
        #palette {
            width: 350px; background: var(--panel); padding: 20px; border-right: 1px solid #333;
            display: flex; flex-direction: column; gap: 10px; overflow-y: auto;
        }

        h2 { font-size: 18px; color: var(--primary); margin: 0 0 10px 0; text-align: center; }
        .group { background: #333; padding: 10px; border-radius: 5px; margin-bottom: 5px; }
        label { font-size: 11px; color: #aaa; display: block; margin-bottom: 5px; }
        
        input, select, button {
            width: 100%; background: #444; border: 1px solid #555; color: white; 
            padding: 8px; border-radius: 4px; margin-bottom: 10px; box-sizing: border-box;
        }

        button { cursor: pointer; font-weight: bold; background: #444; }
        button:hover { background: #555; border-color: var(--primary); }
        .btn-save { background: #25d366; color: black; font-size: 16px; padding: 15px; border: none; }

        /* AREA DE DISEÃ‘O */
        #workspace { flex-grow: 1; display: flex; justify-content: center; align-items: center; background: #1e1e1e; }

        #canvas {
            width: 360px; height: 640px; background: black; position: relative;
            background-size: cover; background-position: center; overflow: hidden;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        .draggable {
            position: absolute; cursor: move; user-select: none;
            display: inline-block; padding: 5px; outline: none;
        }
        
        .selected { border: 2px dashed var(--primary) !important; }

        img.draggable { width: 100px; height: auto; }
    </style>
</head>
<body>

    <aside id="palette">
        <h2>ESTUDIO FIXITECH</h2>
        
        <div class="group">
            <label>FONDO (URL)</label>
            <input type="text" placeholder="Pega URL de imagen..." onchange="document.getElementById('canvas').style.backgroundImage=`url('${this.value}')` text">
        </div>

        <div class="group">
            <label>AGREGAR ELEMENTOS</label>
            <button onclick="addText()">+ Agregar Texto</button>
            <input type="file" id="fileImg" accept="image/*" style="display:none" onchange="uploadImg(event)">
            <button onclick="document.getElementById('fileImg').click()">+ Subir Logo/Imagen</button>
        </div>

        <div id="controls" class="group" style="display:none;">
            <label>EDICIÃ“N DE SELECCIONADO</label>
            
            <label>TamaÃ±o / Ancho:</label>
            <input type="range" min="10" max="500" value="20" oninput="updateProp('size', this.value)">
            
            <label>Color de Texto:</label>
            <input type="color" oninput="updateProp('color', this.value)">
            
            <label>Sombra (0 a 20px):</label>
            <input type="range" min="0" max="20" value="0" oninput="updateProp('shadow', this.value)">
            
            <label>Borde/Filo (0 a 5px):</label>
            <input type="range" min="0" max="5" step="0.5" value="0" oninput="updateProp('stroke', this.value)">
            
            <button onclick="deleteEl()" style="background:#aa3333; border:none;">Eliminar</button>
        </div>

        <button class="btn-save" onclick="save()">ðŸ“¥ DESCARGAR ESTADO</button>
    </aside>

    <main id="workspace">
        <div id="canvas">
            <div class="draggable" style="top:50px; left:80px; font-size:40px; color:#00d4ff; font-weight:bold;">FIXITECH</div>
            <div class="draggable" style="top:150px; left:20px; font-size:20px; color:white;">SERVICIO TÃ‰CNICO</div>
        </div>
    </main>

    <script>
        let selected = null;

        function addText() {
            const div = document.createElement('div');
            div.className = 'draggable';
            div.innerHTML = 'Nuevo Texto';
            div.style.left = '50px'; div.style.top = '200px';
            div.style.fontSize = '20px'; div.style.color = 'white';
            initElement(div);
            document.getElementById('canvas').appendChild(div);
        }

        function uploadImg(e) {
            const reader = new FileReader();
            reader.onload = function() {
                const img = document.createElement('img');
                img.src = reader.result;
                img.className = 'draggable';
                img.style.left = '50px'; img.style.top = '50px';
                initElement(img);
                document.getElementById('canvas').appendChild(img);
            }
            reader.readAsDataURL(e.target.files[0]);
        }

        function initElement(el) {
            el.addEventListener('mousedown', function(e) {
                if(selected) selected.classList.remove('selected');
                selected = el;
                selected.classList.add('selected');
                document.getElementById('controls').style.display = 'block';
                
                // Arrastre
                let shiftX = e.clientX - el.getBoundingClientRect().left;
                let shiftY = e.clientY - el.getBoundingClientRect().top;

                function moveAt(pageX, pageY) {
                    let rect = document.getElementById('canvas').getBoundingClientRect();
                    el.style.left = (pageX - rect.left - shiftX) + 'px';
                    el.style.top = (pageY - rect.top - shiftY) + 'px';
                }

                function onMouseMove(e) { moveAt(e.pageX, e.pageY); }
                document.addEventListener('mousemove', onMouseMove);
                document.onmouseup = function() {
                    document.removeEventListener('mousemove', onMouseMove);
                    document.onmouseup = null;
                };
            });

            el.addEventListener('dblclick', function() {
                if(el.tagName !== 'IMG') el.contentEditable = true; el.focus();
            });
        }

        function updateProp(prop, val) {
            if(!selected) return;
            if(prop === 'size') {
                if(selected.tagName === 'IMG') selected.style.width = val + 'px';
                else selected.style.fontSize = val + 'px';
            }
            if(prop === 'color') selected.style.color = val;
            if(prop === 'shadow') selected.style.textShadow = `${val}px ${val}px 10px rgba(0,0,0,0.8)`;
            if(prop === 'stroke') selected.style.webkitTextStroke = `${val}px black`;
        }

        function deleteEl() { selected.remove(); selected = null; document.getElementById('controls').style.display = 'none'; }

        function save() {
            if(selected) selected.classList.remove('selected');
            html2canvas(document.getElementById('canvas'), {useCORS: true}).then(canvas => {
                const link = document.createElement('a');
                link.download = 'estado_fixitech.png';
                link.href = canvas.toDataURL();
                link.click();
            });
        }

        // Inicializar los que ya estÃ¡n
        document.querySelectorAll('.draggable').forEach(initElement);
    </script>
</body>
</html>
